# src/main/resources/application-dev.yml
spring:
  profiles:
    active: dev
  
  application:
    name: cgv-api
  
  # Redis 설정 (ElastiCache Serverless)
  data:
    redis:
      host: cgv-redis-cluster.serverlessredis.cache.amazonaws.com
      port: 6379
      ssl: true
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 10
          max-idle: 5
          min-idle: 2
          max-wait: -1ms
        cluster:
          refresh:
            adaptive: true
            period: 30s
  
  # RDS Aurora 설정
  datasource:
    write:
      jdbc-url: jdbc:mysql://iamroot-cgv-db-cluster-instance-1.cfucw40ewjht.ap-northeast-2.rds.amazonaws.com:3306/cgv?useSSL=true&requireSSL=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Seoul
      driver-class-name: com.mysql.cj.jdbc.Driver
      username: ${DB_USERNAME}
      password: ${DB_PASSWORD}
      hikari:
        pool-name: WriteHikariPool
        maximum-pool-size: 10
        minimum-idle: 2
        connection-timeout: 30000
        idle-timeout: 600000
        max-lifetime: 1800000
        
    read:
      jdbc-url: jdbc:mysql://iamroot-cgv-db-cluster-instance-1.cfucw40ewjht.ap-northeast-2.rds.amazonaws.com:3306/cgv?useSSL=true&requireSSL=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Seoul
      driver-class-name: com.mysql.cj.jdbc.Driver
      username: ${DB_USERNAME}
      password: ${DB_PASSWORD}
      hikari:
        pool-name: ReadHikariPool
        maximum-pool-size: 15
        minimum-idle: 5
        connection-timeout: 30000

  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        show_sql: true
        format_sql: true
        use_sql_comments: true

# 대기열 설정
admission:
  max-active-sessions: 10
  session-timeout-seconds: 300
  kinesis-stream-name: cgv-admissions-stream

# AWS 설정
aws:
  region: ap-northeast-2
  kinesis:
    # VPC Endpoint DNS 사용
    endpoint: https://vpce-027efebfc7fc97991-mxwg66tq.kinesis.ap-northeast-2.vpce.amazonaws.com
    use-vpc-endpoint: true
  credentials:
    use-irsa: true  # IRSA 사용

# 로깅
logging:
  level:
    root: INFO
    com.example: DEBUG
    org.springframework.web: DEBUG
    org.springframework.data.redis: DEBUG
    software.amazon.awssdk: DEBUG
    io.lettuce.core: DEBUG

# 서버 설정
server:
  port: 8080
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true

# CORS 설정
app:
  cors:
    allowed-origins:
      - https://dev.cgv.example.com
      - http://localhost:5173
      - http://localhost:3000
  websocket:
    allowed-origins:
      - https://dev.cgv.example.com
      - http://localhost:5173